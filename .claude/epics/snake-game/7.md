---
name: Game States & UI Flow
status: open
created: 2025-11-15T16:20:35Z
updated: 2025-11-15T16:47:38Z
github: https://github.com/imezh/snake-game/issues/7
depends_on: [3, 6]
parallel: false
conflicts_with: [6]
---

# Task: Game States & UI Flow

## Description
Implement UI screens for all game states (START, PLAYING, PAUSED, GAME_OVER) with proper keyboard controls for navigation and state transitions. Create start screen with instructions, pause overlay, and game over screen with restart options.

## Acceptance Criteria
- [ ] Start screen displays title and "Press Space to Start"
- [ ] Start screen shows high score if one exists
- [ ] Spacebar starts game from start screen
- [ ] Pause functionality works via Spacebar or P key during gameplay
- [ ] Pause screen shows "Paused" message and resume instructions
- [ ] Game over screen displays final score and "Game Over" message
- [ ] Game over screen shows restart option
- [ ] ESC key returns to start screen from any state
- [ ] Enter key can restart game from game over screen
- [ ] All state transitions are smooth and clean

## Technical Details

**Start Screen Rendering:**
```javascript
function renderStartScreen() {
  clearCanvas();

  ctx.fillStyle = COLORS.text;
  ctx.font = 'bold 48px monospace';
  ctx.textAlign = 'center';
  ctx.fillText('SNAKE GAME', canvas.width / 2, canvas.height / 3);

  ctx.font = '20px monospace';
  ctx.fillText('Press SPACE to Start', canvas.width / 2, canvas.height / 2);

  // Show high score if exists
  const highScore = getHighScore(); // From leaderboard
  if (highScore > 0) {
    ctx.fillText(`High Score: ${highScore}`, canvas.width / 2, canvas.height / 2 + 40);
  }

  ctx.font = '14px monospace';
  ctx.fillText('Use Arrow Keys to Move', canvas.width / 2, canvas.height / 1.5);
  ctx.fillText('Press ESC to Return to Menu', canvas.width / 2, canvas.height / 1.5 + 25);
}
```

**Pause Screen Rendering:**
```javascript
function renderPauseOverlay() {
  // Semi-transparent overlay
  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = COLORS.text;
  ctx.font = 'bold 36px monospace';
  ctx.textAlign = 'center';
  ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2);

  ctx.font = '18px monospace';
  ctx.fillText('Press SPACE to Resume', canvas.width / 2, canvas.height / 2 + 40);
  ctx.fillText('Press ESC for Menu', canvas.width / 2, canvas.height / 2 + 70);
}
```

**Game Over Screen Rendering:**
```javascript
function renderGameOverScreen() {
  clearCanvas();

  ctx.fillStyle = COLORS.text;
  ctx.font = 'bold 42px monospace';
  ctx.textAlign = 'center';
  ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 3);

  ctx.font = '24px monospace';
  ctx.fillText(`Final Score: ${score}`, canvas.width / 2, canvas.height / 2);

  ctx.font = '18px monospace';
  ctx.fillText('Press SPACE to Restart', canvas.width / 2, canvas.height / 1.6);
  ctx.fillText('Press L to View Leaderboard', canvas.width / 2, canvas.height / 1.6 + 30);
  ctx.fillText('Press ESC for Menu', canvas.width / 2, canvas.height / 1.6 + 60);

  // Check if score made leaderboard
  if (isTopScore(score)) {
    ctx.fillStyle = COLORS.food;
    ctx.fillText('NEW HIGH SCORE!', canvas.width / 2, canvas.height / 2 + 40);
  }
}
```

**Enhanced Input Handler:**
```javascript
function handleKeyPress(event) {
  const key = event.key;

  switch (stateManager.currentState) {
    case GameStates.START:
      if (key === ' ') {
        startGame();
      }
      break;

    case GameStates.PLAYING:
      // Arrow keys (existing logic)
      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(key)) {
        event.preventDefault();
        // Direction change logic
      }
      // Pause game
      if (key === ' ' || key.toLowerCase() === 'p') {
        event.preventDefault();
        pauseGame();
      }
      // Return to menu
      if (key === 'Escape') {
        returnToMenu();
      }
      break;

    case GameStates.PAUSED:
      if (key === ' ' || key.toLowerCase() === 'p') {
        event.preventDefault();
        resumeGame();
      }
      if (key === 'Escape') {
        returnToMenu();
      }
      break;

    case GameStates.GAME_OVER:
      if (key === ' ' || key === 'Enter') {
        restartGame();
      }
      if (key.toLowerCase() === 'l') {
        showLeaderboard(); // Will be implemented in task 007
      }
      if (key === 'Escape') {
        returnToMenu();
      }
      break;
  }
}
```

**State Transition Functions:**
```javascript
function startGame() {
  resetGame();
  stateManager.transition(GameStates.PLAYING);
}

function pauseGame() {
  stateManager.transition(GameStates.PAUSED);
}

function resumeGame() {
  stateManager.transition(GameStates.PLAYING);
}

function gameOver() {
  saveScore(score); // Will be implemented in task 007
  stateManager.transition(GameStates.GAME_OVER);
}

function returnToMenu() {
  stateManager.transition(GameStates.START);
}

function restartGame() {
  resetGame();
  stateManager.transition(GameStates.PLAYING);
}

function resetGame() {
  // Reset snake
  snake.segments = [
    {x: 10, y: 10},
    {x: 9, y: 10},
    {x: 8, y: 10}
  ];
  snake.direction = {x: 1, y: 0};
  snake.nextDirection = {x: 1, y: 0};
  snake.growing = false;

  // Reset score and food
  score = 0;
  generateFood();

  // Reset difficulty (will be implemented in task 008)
  resetDifficulty();

  // Clear input queue
  inputQueue.length = 0;
}
```

**Code Locations:**
- `game.js`: Render functions for each state, enhanced input handler, state transition functions

## Dependencies
- [ ] Task 002 completed (state management)
- [ ] Task 005 completed (rendering functions)

## Effort Estimate
- **Size:** M
- **Hours:** 10-12 hours
- **Parallel:** false (modifies same file as task 005)

## Definition of Done
- [ ] Start screen displays correctly with title and instructions
- [ ] High score shown on start screen when available
- [ ] Spacebar starts game from start screen
- [ ] Game can be paused and resumed with Spacebar/P key
- [ ] Pause overlay displays over game
- [ ] Game over screen shows final score
- [ ] Can restart from game over with Space or Enter
- [ ] ESC returns to menu from any state
- [ ] All transitions are smooth without glitches
- [ ] Input only processed for current state (no bleed-through)
- [ ] Visual feedback for new high score on game over
- [ ] Code is well-commented
