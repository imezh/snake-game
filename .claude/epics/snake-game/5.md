---
name: Collision & Food Systems
status: completed
created: 2025-11-15T16:20:35Z
updated: 2025-11-15T17:15:00Z
completed: 2025-11-15T17:15:00Z
github: https://github.com/imezh/snake-game/issues/5
depends_on: [4]
parallel: false
conflicts_with: []
---

# Task: Collision & Food Systems

## Description
Implement collision detection for walls and self-collision, plus food generation and consumption logic. Food should spawn randomly on valid grid positions (not on snake), and collisions should trigger appropriate game responses (growth for food, game over for walls/self).

## Acceptance Criteria
- [x] Wall collision detection (x/y outside grid bounds) works correctly
- [x] Self-collision detection (head hits body segment) works correctly
- [x] Food spawns at random valid positions on grid
- [x] Food never spawns on snake body
- [x] Food-snake collision detected accurately
- [x] Consuming food triggers snake growth
- [x] Score increases by 10 points per food consumed
- [x] New food spawns immediately after consumption
- [x] Wall collision triggers game over state
- [x] Self-collision triggers game over state

## Technical Details

**Collision Detection:**
```javascript
function checkWallCollision() {
  const head = snake.segments[0];

  return (
    head.x < 0 ||
    head.x >= GRID_SIZE ||
    head.y < 0 ||
    head.y >= GRID_SIZE
  );
}

function checkSelfCollision() {
  const head = snake.segments[0];

  // Check if head collides with any body segment (skip head itself)
  for (let i = 1; i < snake.segments.length; i++) {
    if (head.x === snake.segments[i].x && head.y === snake.segments[i].y) {
      return true;
    }
  }

  return false;
}

function checkCollisions() {
  if (checkWallCollision() || checkSelfCollision()) {
    gameOver();
  }
}
```

**Food System:**
```javascript
let food = null;
let score = 0;

function generateFood() {
  let newFood;
  let validPosition = false;

  while (!validPosition) {
    newFood = {
      x: Math.floor(Math.random() * GRID_SIZE),
      y: Math.floor(Math.random() * GRID_SIZE)
    };

    // Check if food position is on snake
    validPosition = !isOnSnake(newFood);
  }

  food = newFood;
}

function isOnSnake(position) {
  return snake.segments.some(segment =>
    segment.x === position.x && segment.y === position.y
  );
}

function checkFoodCollision() {
  const head = snake.segments[0];

  if (food && head.x === food.x && head.y === food.y) {
    consumeFood();
  }
}

function consumeFood() {
  score += 10;
  growSnake();
  generateFood();
  updateDifficulty(); // Will be implemented in task 008
}
```

**Integration with Game Loop:**
```javascript
function updateGameLogic() {
  processInputQueue();
  moveSnake();
  checkFoodCollision();
  checkCollisions();
}
```

**Code Locations:**
- `game.js`: Collision detection functions, food generation, score tracking

**Key Considerations:**
- Food generation must ensure valid position (not on snake)
- Infinite loop protection if grid becomes full (unlikely but possible)
- Collision checks happen after movement but before rendering
- Score tracking needs to be accessible for display and leaderboard
- Self-collision check excludes head from body comparison

## Dependencies
- [x] Task 003 completed (snake and movement logic)

## Effort Estimate
- **Size:** M
- **Hours:** 10-12 hours
- **Parallel:** false (depends on snake movement)

## Definition of Done
- [x] Wall collisions detected correctly on all four boundaries
- [x] Self-collision detected when snake head hits any body segment
- [x] Food spawns only on valid (empty) grid cells
- [x] Food never spawns on snake body (tested extensively)
- [x] Eating food increases score by 10 points
- [x] Eating food triggers snake growth
- [x] New food appears immediately after consumption
- [x] Collisions trigger game over state correctly
- [x] Edge cases tested (food at boundaries, long snake)
- [x] No off-by-one errors in grid bounds checking
- [x] Score displayed correctly (even if UI not fully styled)
- [x] Code is well-commented
