---
name: Progressive Difficulty
status: open
created: 2025-11-15T16:20:35Z
updated: 2025-11-15T16:20:35Z
github: null
depends_on: [004]
parallel: true
conflicts_with: []
---

# Task: Progressive Difficulty

## Description
Implement progressive difficulty system that increases game speed by 8% every 5 food items consumed. Cap maximum speed at 50ms per move to maintain playability. Track food count and dynamically adjust game update interval to create engaging difficulty curve.

## Acceptance Criteria
- [ ] Game speed increases by 8% every 5 food items eaten
- [ ] Food count tracked separately from score
- [ ] Speed calculation uses correct formula
- [ ] Minimum speed cap of 50ms enforced
- [ ] Speed changes are smooth and not jarring
- [ ] Difficulty resets when game restarts
- [ ] Current speed accessible for debugging/display (optional)
- [ ] Difficulty curve feels balanced and fair

## Technical Details

**Configuration Constants:**
```javascript
const BASE_SPEED = 150; // ms per game tick (initial speed)
const MIN_SPEED = 50;   // ms per game tick (maximum difficulty)
const SPEED_INCREASE_INTERVAL = 5; // food items before speed increase
const SPEED_MULTIPLIER = 0.92; // 8% faster = 0.92x time (1 - 0.08)
```

**Difficulty Tracking:**
```javascript
let currentSpeed = BASE_SPEED;
let foodCount = 0;

function updateDifficulty() {
  foodCount++;

  // Calculate speed based on food count
  const speedLevel = Math.floor(foodCount / SPEED_INCREASE_INTERVAL);
  const newSpeed = BASE_SPEED * Math.pow(SPEED_MULTIPLIER, speedLevel);

  // Apply minimum speed cap
  currentSpeed = Math.max(MIN_SPEED, newSpeed);
}

function resetDifficulty() {
  currentSpeed = BASE_SPEED;
  foodCount = 0;
}

function getCurrentSpeed() {
  return currentSpeed;
}
```

**Integration with Game Loop:**
```javascript
// Modify the game loop to use dynamic speed
function gameLoop(currentTime) {
  requestAnimationFrame(gameLoop);

  const deltaTime = currentTime - lastFrameTime;
  lastFrameTime = currentTime;

  accumulator += deltaTime;

  // Use currentSpeed instead of fixed GAME_SPEED
  while (accumulator >= currentSpeed) {
    update();
    accumulator -= currentSpeed;
  }

  render();
}
```

**Integration with Food Consumption:**
```javascript
function consumeFood() {
  score += 10;
  foodCount++; // Track food count
  growSnake();
  generateFood();
  updateDifficulty(); // Adjust speed
}
```

**Optional: Display Current Speed (for debugging):**
```javascript
function drawDebugInfo() {
  ctx.fillStyle = COLORS.text;
  ctx.font = '12px monospace';
  ctx.textAlign = 'right';
  ctx.fillText(`Speed: ${currentSpeed.toFixed(0)}ms`, canvas.width - 10, canvas.height - 10);
  ctx.fillText(`Food: ${foodCount}`, canvas.width - 10, canvas.height - 25);
}
```

**Difficulty Curve Analysis:**
```
Food Count | Speed Level | Speed (ms) | Speed Increase
-----------|-------------|------------|---------------
0-4        | 0           | 150        | baseline
5-9        | 1           | 138        | +8%
10-14      | 2           | 127        | +16%
15-19      | 3           | 117        | +24%
20-24      | 4           | 107        | +32%
25-29      | 5           | 99         | +40%
30-34      | 6           | 91         | +48%
35-39      | 7           | 84         | +56%
40-44      | 8           | 77         | +64%
45-49      | 9           | 71         | +72%
50-54      | 10          | 65         | +80%
55-59      | 11          | 60         | +88%
60+        | 12+         | 50 (cap)   | +100%
```

**Code Locations:**
- `game.js`: Difficulty tracking variables, updateDifficulty function, integration with game loop and food consumption

**Key Considerations:**
- foodCount is separate from score (food worth 10 points each)
- Math.pow correctly calculates exponential speed increase
- Speed cap prevents impossible gameplay
- Difficulty resets on game restart
- Speed changes happen immediately but feel smooth
- Formula creates engaging progression curve

## Dependencies
- [ ] Task 004 completed (food consumption logic)

## Effort Estimate
- **Size:** S
- **Hours:** 3-4 hours
- **Parallel:** true (independent feature, minimal code overlap)

## Definition of Done
- [ ] Speed increases by 8% every 5 food items
- [ ] Speed calculation formula correct and tested
- [ ] Minimum speed cap (50ms) enforced
- [ ] foodCount tracked separately from score
- [ ] Difficulty resets on game restart
- [ ] Speed changes integrated into game loop
- [ ] No sudden jumps or glitches in difficulty
- [ ] Tested at various difficulty levels
- [ ] Difficulty curve feels balanced
- [ ] Code is well-commented
- [ ] Optional debug display implemented (if helpful)
